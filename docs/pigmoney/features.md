# PigMoney 기능 상세 기획

## 1. 메인 쓰기 페이지 (`/pigmoney`)

### 레이아웃

```
┌───────────┬──────────────────────────────────────────────┐
│           │ [지출(N)] [수입(N)]  [시작일]~[종료일]          │
│  사이드바  │ [전체 토글] [검색]                [거래 추가]   │
│           ├──────────────────────────────────────────────┤
│  - 네비   │  날짜  │ 사용내역  │ 금액  │ 분류 │ 태그 │ 액션 │
│  - 요약   │  ...  │  ...    │  ... │  .. │  — │ ✏🗑 │
│  - 관리   │       │         │      │     │    │      │
│           ├──────────────────────────────────────────────┤
│           │  합계:                            XXX,XXX 원 │
└───────────┴──────────────────────────────────────────────┘
```

### 사이드바

- **로고**: PiggyBank 아이콘 + "PigMoney"
- **프로필**: 사용자 아바타 + 이름
- **네비게이션**: 쓰기, 보고서, 달력, 설정 (현재 페이지 하이라이트)
- **이달의 가계**: 설정된 월 시작일 기반 수입/지출/잔액 요약
- **이주의 가계**: 설정된 주 시작 요일 기반 수입/지출/잔액 요약
- **카테고리 관리**: 모달로 카테고리 CRUD

### 메인 영역

- 지출/수입 탭 전환
- 날짜 구간 선택 + 전체 토글 + 검색
- 테이블 형태로 거래 목록 표시
- 각 행에 수정/삭제 액션

### 기본 조회 로직

- 페이지 진입 시 **최근 1주일** 데이터를 자동으로 조회
- "전체" 토글 ON 시 전체 기간 조회

---

## 2. 거래 작성 (모달)

### 구조

- 하나의 모달에서 수입/지출을 구분 없이 다중 행 동시 입력
- 각 행에 수입/지출 토글이 있어 행별로 타입 결정

### 입력 행 구조

| 필드 | 유형 | 필수 | 설명 |
|------|------|------|------|
| 수입/지출 토글 | Switch | O | 기본값: 지출 |
| 날짜 | DatePicker | O | 거래 발생 날짜 |
| 카테고리 | Select | O | 사용자 카테고리 목록 |
| 내용 | Text Input | O | 거래 내용 |
| 금액 | Number Input | O | 양의 정수만 |
| 비고 | Text Input | X | 추가 메모 |
| 삭제 | Button | - | 행이 1개뿐이면 비활성화 |

### 행 추가/저장

- "행 추가" 버튼으로 새 입력 행 추가 (기본값: 지출, 오늘 날짜)
- "저장" 시 모든 행에 Zod validation → 서버 일괄 저장

---

## 3. 거래 수정/삭제

- **수정**: 테이블 행의 수정 버튼 → 단일 행 수정 모달
- **삭제**: 확인 다이얼로그 → 낙관적 업데이트로 즉시 삭제
- CRUD 성공 시 사이드바 요약 자동 갱신 (`invalidateSummary`)

---

## 4. 카테고리 관리

### 기본 카테고리

첫 접속 시 자동 생성: 식비, 간식, 구독

### 관리 기능

- 별도 모달에서 카테고리 CRUD
- 카테고리 삭제: 연결된 거래가 없을 때만 가능

---

## 5. 사용자 설정 (`/pigmoney/settings`)

### 설정 항목

| 항목 | 범위 | 기본값 | 설명 |
|------|------|--------|------|
| 월 시작일 | 1~28 | 1 | 이달의 가계 기간 기준 |
| 주 시작 요일 | 일~토 | 일요일 | 이주의 가계 기간 기준 |

### 동작 방식

- Select 드롭다운으로 선택 후 "저장" 버튼
- 설정 변경 시 사이드바 요약 자동 재계산
- **월 시작일 예시**: 25일 설정 → "이 달" = n월 25일 ~ (n+1)월 24일
- **주 시작 요일 예시**: 금요일 설정 → "이 주" = 금~목

---

## 6. 보고서 (`/pigmoney/report`)

### 레이아웃

```
┌──────────────────────────────────────────────┐
│  보고서                    < 2026년 2월 >     │
├──────────────────────────────────────────────┤
│  [총 수입 카드]  [총 지출 카드]  [잔액 카드]    │
├──────────────────┬───────────────────────────┤
│  지출 카테고리     │  수입 카테고리              │
│  (도넛 차트 +     │  (도넛 차트 +              │
│   범례)          │   범례)                    │
├──────────────────┴───────────────────────────┤
│  카테고리별 상세                                │
│  지출                     수입                │
│  카테고리 | 금액 | 비율    카테고리 | 금액 | 비율 │
└──────────────────────────────────────────────┘
```

### 기능

- **월 선택기**: 좌우 화살표로 월 이동, 월 변경 시 데이터 재조회
- **요약 카드**: 총 수입 / 총 지출 / 잔액 3칸 표시
- **도넛 차트**: recharts PieChart, 카테고리별 지출/수입 비율
- **상세 테이블**: 카테고리별 금액과 비율 (금액 내림차순)
- 설정된 `monthStartDay` 반영하여 월 범위 계산

---

## 7. 달력 (`/pigmoney/calendar`)

### 레이아웃

```
┌──────────────────────────────────────────────┐
│  달력                                        │
├──────────────────────────────────────────────┤
│       < 2026년 2월 >                          │
│  일  월  화  수  목  금  토                    │
│  ┌──┬──┬──┬──┬──┬──┬──┐                     │
│  │26│27│28│29│30│31│ 1│  각 셀 높이 h-20      │
│  │  │  │  │  │  │  │  │  +수입금액            │
│  │  │  │  │  │  │  │  │  -지출금액            │
│  ├──┼──┼──┼──┼──┼──┼──┤                     │
│  │ 2│ 3│...                                  │
│  └──┴──┴──┴──┴──┴──┴──┘                     │
├──────────────────────────────────────────────┤
│  2026.02.11 거래 내역                         │
│  유형 │ 내용 │ 카테고리 │ 금액                  │
│  지출 │ 점심 │ 식비    │ -8,000 원             │
└──────────────────────────────────────────────┘
```

### 기능

- **react-day-picker v9** DayButton 커스터마이즈로 셀 내 금액 표시
- **주 시작 요일**: `weekStartsOn` prop으로 사용자 설정 반영
- **금액 축약**: 만 단위 이상은 "1.5만" 형태로 표시
- **날짜 클릭**: 하단에 해당 일자 거래 목록 테이블 표시
- **월 이동**: 월 변경 시 데이터 재조회

---

## 8. 사이드바 요약 동작 흐름

```
1. 페이지 로드 → getSettings() → 스토어에 settings 저장
2. useSidebarSummary 훅 실행
   → settings.monthStartDay로 이달 범위 계산 (getCustomMonthRange)
   → settings.weekStartDay로 이주 범위 계산 (getCustomWeekRange)
   → getCashRecordSummary()로 각 범위의 합계 조회
   → 스토어에 monthSummary, weekSummary 저장
3. 거래 CRUD 성공 시 → invalidateSummary() 호출
   → summaryVersion 증가
   → useSidebarSummary가 자동 재조회
```
